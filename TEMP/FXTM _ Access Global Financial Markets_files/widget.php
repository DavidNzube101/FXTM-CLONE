(function(window) {
var params = {
origin: encodeURIComponent(window.location.origin)
};
var delay = 0;
var iframe = '<script>window.passUtmData = window.passUtmData || function(){ console.log(\"passUtmData was not loaded at the moment\"); }</script><iframe id=\"registration-step1-widget-iframe\" data-src=\"https://my.fxtmng.com/en/identity/registration/?theme=&sbt=&abt=&lbt=&sw=&cs=&dlt=&product=trading&origin={origin}&current_url=https://register.fxtmng.com/&company=global&version=98111&type=new&new-gtm=&disable_web_analytic=true\" frameborder=\"0\" width=\"100%\" height=\"1100px\" onload=\"passUtmData(this)\"></iframe><script>(function (window) {      function redirectToMy(mParticleLoginResponse) {          let mParticleUser = mParticleLoginResponse && mParticleLoginResponse.getUser && mParticleLoginResponse.getUser();          if (mParticleUser) {              mParticleUser.setUserAttribute(\"gtm_cid\", true);          }          var iframe = document.getElementById(\"registration-step1-widget-iframe\");          setTimeout(function () {              iframe && iframe.contentWindow && iframe.contentWindow.postMessage({type: \"regWidgetRedirectToMyFXTM\"}, \"https://my.fxtmng.com\");          }, 1000);      }      function logAnalyticEvent(event) {          var message = event.data || {};          message.payload = message.payload || {};          try {              if (message.type === \"reg_form_done\" || message.type === \"login_successful\") {                  Promise.allSettled([                      logSuccessAuthMParticle(message),                      logSuccessAuthGTM(message)                  ]).then(([mParticleLoginResponse, gtmResult]) => {                      redirectToMy(mParticleLoginResponse);                  });              } else if (message.type == \"regWidgetAnalyticTracker\") {                  logAnalyticEventMParticle(message);                  logAnalyticEventGTM(message);              }          } catch(e) {              console.warn(\"error in logAnalyticEvent\", e);          }      }      function logSuccessAuthMParticle(message) {          var mParticle = window.mParticle;          if (!mParticle) {              return Promise.reject(\"no mParticle load\");          }          return new Promise(function(resolve, reject) {              let gaClientId = \"\";              try {                  gaClientId = ga.getAll()[0].get(\"clientId\");              } catch (err) {                  console.log(\"cannot get ga client id\", err);                  gaClientId = \"\";              }              mParticle.Identity && mParticle.Identity.login({                  userIdentities: {                      customerid: message.payload.client_id,                      email: message.payload.email,                      other: message.payload.client_id,                      other4: gaClientId                  }              }, function (response) {                  mParticle.logEvent(message.type, mParticle.EventType.Other);                  resolve(response);              });          });      }            function logSuccessAuthGTM(message) {          return new Promise(function(resolve, reject) {              var dataLayer = window.dataLayer || [];              dataLayer.push({                  event: \"client_identified\",                  email_hashed: message.payload.email_hash,                  email: message.payload.email,                  myfxtm_id: message.payload.client_id,                  eventCallback: function() {                     resolve(\"makeRedirect\");                  },                  eventTimeout: 3000              });          }).then(function(result){              dataLayer.push({                 event: message.type              });              return result;          });      }            function logAnalyticEventGTM(message) {          var dataLayer = window.dataLayer || [];          dataLayer.push(message.payload);      }             function logAnalyticEventMParticle(message) {          var mParticle = window.mParticle;          if (mParticle) {              try {                  var attributes = JSON.parse(JSON.stringify(message.payload)) || {};              } catch (e) {                  attributes = {};              }              delete attributes.event;              mParticle.logEvent(message.payload.event, mParticle.EventType.Other, attributes);          }      }              try {           window.addEventListener(\"message\", function (e) {               var iframe = document.getElementById(\"registration-step1-widget-iframe\");               if (iframe && e.data && e.data.contentHeight) {                   iframe.setAttribute(\"height\", e.data.contentHeight);               }               if (iframe && e.data && e.data.scrollToRegStep1Widget) {                   iframe.scrollIntoView && iframe.scrollIntoView();               }               logAnalyticEvent(e);           });       } catch (e) {           console.error(e);       }       try {           var partnerMetaTag = document.querySelector(\"meta[name=\'forextime_partner\']\");           if (partnerMetaTag) {               var partnerId = partnerMetaTag.content;               var iframe = document.getElementById(\"registration-step1-widget-iframe\");               if (iframe) {                   var src = iframe.getAttribute(\"data-src\");                   if (src) {                       src += (src.indexOf(\"?\") === -1 ? \"?\" : \"&\") + \"partner_id=\" + partnerId;                       iframe.setAttribute(\"data-src\", src);                   }               }           }       } catch (e) {           console.error(\"Error updating iframe data-src:\", e);       }   })(window);(()=>{\"use strict\";(()=>{function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var t=function t(n,r){function o(t,o,i){if(\"undefined\"!=typeof document){\"number\"==typeof(i=e({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a=\"\";for(var c in i)i[c]&&(a+=\"; \"+c,!0!==i[c]&&(a+=\"=\"+i[c].split(\";\")[0]));return document.cookie=t+\"=\"+n.write(o,t)+a}}return Object.create({set:o,get:function(e){if(\"undefined\"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split(\"; \"):[],r={},o=0;o<t.length;o++){var i=t[o].split(\"=\"),a=i.slice(1).join(\"=\");try{var c=decodeURIComponent(i[0]);if(r[c]=n.read(a,c),e===c)break}catch(e){}}return e?r[e]:r}},remove:function(t,n){o(t,\"\",e({},n,{expires:-1}))},withAttributes:function(n){return t(this.converter,e({},this.attributes,n))},withConverter:function(n){return t(e({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(n)}})}({read:function(e){return\'\"\'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:\"/\"});!function(e,n){let r=\".\"+n.domain.replace(\"www.\",\"\"),o={},i=n.location.search;if(i=0===i.indexOf(\"?\")?i.substr(1):\"\",i.length){let e=i.split(\"&\");for(let t=0,n=e.length;t<n;t++){let n=e[t].split(\"=\");o[n[0]]=n[1]}}let a=[\"partner_id\",\"HJDSauj87sDAbjb\",\"form\",\"referral\",\"formx\",\"Referral\",\"Formx\"],c=!1;for(let e=0;e<=a.length;e++)o[a[e]]&&(o.partner_id=o[a[e]],-1!==[\"referral\",\"formx\",\"Referral\",\"Formx\"].indexOf(a[e])&&(c=!0));if(c&&(o.partner_source=\"fynxt_fxtm\"),void 0!==o.utm_blocka){let e=new Date,n=e.getTime();n+=7776e6,e.setTime(n),t.set(\"utm_blocka\",o.utm_blocka,{expires:e,path:\"/\",domain:r})}if(void 0!==o.utm_entry_product){let e=new Date,n=e.getTime();n+=7776e6,e.setTime(n),t.set(\"utm_entry_product\",o.utm_entry_product,{expires:e,path:\"/\",domain:r})}let s=[];if(void 0!==o.partner_id&&s.push(\"partner_id=\"+o.partner_id),void 0!==o.agnt&&s.push(\"agnt=\"+o.agnt),o.agnt){let e=new Date((new Date).getTime()+7776e6);t.set(\"aff[id]\",o.agnt,{expires:e,path:\"/\",domain:r}),t.set(\"aff[date]\",Math.floor((new Date).getTime()/1e3),{expires:e,path:\"/\",domain:r}),t.set(\"agent[agent_id]\",\"\",{expires:-1,path:\"/\",domain:r}),t.set(\"agent[visit_date]\",\"\",{expires:-1,path:\"/\",domain:r}),t.set(\"agent[agent_source]\",\"\",{expires:-1,path:\"/\",domain:r}),t.set(\"agent[agent_campaign_id]\",\"\",{expires:-1,path:\"/\",domain:r})}else if(o.partner_id&&\"null\"!==o.partner_id){let e=new Date((new Date).getTime()+2592e6);t.set(\"agent[agent_id]\",o.partner_id,{expires:e,path:\"/\",domain:r,secure:!0,SameSite:\"None\"}),t.set(\"agent[visit_date]\",Math.floor((new Date).getTime()/1e3),{expires:e,path:\"/\",domain:r,secure:!0,SameSite:\"None\"}),o.partner_source&&t.set(\"agent[agent_source]\",o.partner_source,{expires:e,path:\"/\",domain:r,secure:!0,SameSite:\"None\"}),o.partner_campaign_id&&t.set(\"agent[agent_campaign_id]\",o.partner_campaign_id,{expires:e,path:\"/\",domain:r,secure:!0,SameSite:\"None\"}),t.set(\"aff[id]\",\"\",{expires:-1,path:\"/\",domain:r}),t.set(\"aff[date]\",\"\",{expires:-1,path:\"/\",domain:r})}if(e.REFERER||\"\"!==n.referrer){let t=e.REFERER||n.referrer;s.push(\"referer=\"+encodeURIComponent(t))}else s.push(\"referer=\");const u=[\"staging\",\"dev\",\"loc\",\".rc.\",\".dom\",\".aru\"].find((t=>{if(e.location.href.indexOf(t)>-1)return!0}));if(s.length&&void 0===u){let t=new Image;e.location.href.indexOf(\"alpari.com\")>-1?t.src=\"/track/?\"+s.join(\"&\"):t.src=\"/track?\"+s.join(\"&\"),t.className+=\"hide\",t.onload=function(){n.body.appendChild(t)};let r=new Image;r.src=\"/ftrack?\"+s.join(\"&\"),r.className+=\"hide\",r.onload=function(){n.body.appendChild(r)}}if(void 0!==o.raf){let e=new Date;e.setTime(e.getTime()+6048e5),t.set(\"raf\",o.raf,{expires:e,path:\"/\",domain:r})}const l=\"user_partners\",d=[\"cpa_partner_id\",\"partner_id\",\"agent\"];!function(){let n=function(){try{const e=t.get(l);if(!e)return{};const n=JSON.parse(e);return n&&\"object\"==typeof n?n:{}}catch(e){return{}}}();(function(e){return!e.version})(n)&&(n=function(e){return d.filter((t=>e[t])).forEach((t=>{e[t]=Object.entries(e[t]).reduce(((e,[t,n])=>{if(\"current\"===t)return e.current=n,e;const r=new Date(t);if(isNaN(r))return e;if(e[n]){const o=new Date(e[n][0]),i=new Date(e[n][1]);r<o?e[n][0]=t:r>i&&(e[n][1]=t)}else e[n]=[t,t];return e}),{})})),e}(n));const o=function(t){const n=new URLSearchParams(e.location.search),r=[];for(const[e,t]of n)r[e]=t;const o=d.reduce(((e,t)=>{const n=r[t];if(\"string\"!=typeof n)return e;let o=\"string\"!=typeof r.sub_id?\"\":r.sub_id;o=o.replace(/[^0-9a-zA-Z\\_]/g,\"\");const i=(new Date).toLocaleString(\"en-GB\",{year:\"numeric\",month:\"2-digit\",day:\"2-digit\",hour:\"2-digit\",minute:\"2-digit\",second:\"2-digit\",hour12:!1}).replace(/(\\d{2})\\/(\\d{2})\\/(\\d{4}), (\\d{2}):(\\d{2}):(\\d{2})/,\"$3-$2-$1 $4:$5:$6\");return\"agent\"!==t&&(e.id=n,e.type=t,e.date=i,e.sub_id=o),e[t]||(e[t]={}),e[t].current=n,e[t][n]&&Array.isArray(e[t][n])?(e[t][n][1]=i,e[t][n][2]=o):e[t][n]=[i,i,o],e}),t||{});return o.version=1,o}(n);let i=new Date;i.setTime(i.getTime()+31536e6),t.set(l,JSON.stringify(o),{expires:i,secure:!0,sameSite:\"none\",path:\"/\",domain:r})}(),function(){const n=new URLSearchParams(e.location.search),o=[];for(const[e,t]of n)o[e]=t;if(![\"utm_source\",\"utm_medium\",\"utm_term\",\"utm_content\",\"utm_campaign\",\"tracking_source\"].some((e=>o[e])))return null;let i=new Date;i.setTime(i.getTime()+31536e6);const a={expires:i,secure:!0,sameSite:\"none\",path:\"/\",domain:r},c={};[\"utm_source\",\"utm_medium\",\"utm_term\",\"utm_content\",\"utm_campaign\",\"website\",\"add\",\"position\",\"block\",\"info\",\"trans\",\"transkey\",\"device\",\"geo\",\"matchtype\",\"yclid\",\"gclid\",\"tracking_source\"].forEach((e=>{o[e]&&(c[e]=o[e])}));const s=JSON.stringify(c);t.set(\"_landing\",s,a)}()}(window,document),function(e,n){const r=\"utm_new\",o=\"agent[agent_id]\",i=\"agent[agent_source]\",a=\"agent[agent_campaign_id]\",c=\"raf\";function s(e,t,n){void 0!==e&&e.setItem(t,n)}let u=function(e){if(\"\"===e)return{};let t={};for(let n=0;n<e.length;++n){let r=e[n].split(\"=\",2);if(1===r.length)t[r[0]]=\"\";else{t[r[0]]=r[1].replace(/\\+/g,\" \");try{t[r[0]]=decodeURIComponent(t[r[0]])}catch(e){console.warn(e)}}}return t}(e.location.search.substr(1).split(\"&\"));if(!l(u)||\"\"!==e.document.referrer){const d=function(){let e=n.domain.replace(\"www.\",\"\");return e=\".\"+n.domain.replace(\"my.\",\"\"),e}();let f=\"{}\";l(u)||(f=JSON.stringify(u));let p=function(e,n){let r={};try{return void 0!==e&&(r=e.getItem(n)),\"{}\"!==r&&r||(r=t.get(n)),r=JSON.parse(r),r&&\"object\"==typeof r?r:{}}catch(e){return console.warn(e),{}}}(localStorage,r),m=t.get(o)||null,g=t.get(i)||null,h=t.get(a)||null,y=t.get(c)||null;f=function(e,t){let n={};for(let t in e)n[t]=e[t];for(let e in t)n[e]=t[e];return n}(p,JSON.parse(f)),f=function(t){return\"\"!==e.document.referrer&&e.location.origin&&0!==e.document.referrer.indexOf(e.location.origin)&&(t.referrer=e.document.referrer),t}(f),f=JSON.stringify(f),t.set(r,f,{expires:function(e){let t=new Date;return t.setTime(t.getTime()+15552e6),t}(),secure:!0,SameSite:\"None\",path:\"/\",domain:d}),s(localStorage,r,f),s(localStorage,o,m),s(localStorage,i,g),s(localStorage,a,h),s(localStorage,c,y),s(sessionStorage,r,f),s(sessionStorage,o,m),s(sessionStorage,i,g),s(sessionStorage,a,h),s(sessionStorage,c,y),\"undefined\"==typeof localStorage&&\"undefined\"==typeof sessionStorage&&console.warn(\"No supported Storage found.\")}function l(e){return 0===Object.keys(e).filter(Boolean).length}let d=function(e){let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+\"=\"+encodeURIComponent(e[n]));return t.join(\"&\")};function f(){let n=localStorage.getItem(r),s=localStorage.getItem(o),u=localStorage.getItem(i),l=localStorage.getItem(a),d=localStorage.getItem(c);\"{}\"!==n&&n||(n=t.get(r)),\"{}\"!==n&&n||(n=sessionStorage.getItem(r)),s||(s=t.get(o)),s||(s=sessionStorage.getItem(o)),u||(u=t.get(i)),u||(u=sessionStorage.getItem(i)),l||(l=t.get(a)),l||(l=sessionStorage.getItem(a)),d||(d=t.get(c)),d||(d=sessionStorage.getItem(c));try{n=JSON.parse(n)||{}}catch(e){n={}}return n.partner_id=s,n.partner_source=u,n.partner_campaign_id=l,n.raf=d,n.page=e.location.href,n}e.passUtmData=function(e){try{let t=(e.getAttribute(\"src\")||\"\").split(\"?\")[0];if(!t)return;let n={type:\"sendUTMPost\",payload:{data:f()}};e.contentWindow.postMessage(n,t)}catch(e){console.warn(e)}},n.onreadystatechange=function(){if(\"complete\"===n.readyState){let t=n.querySelectorAll(\'[regional-link=\"1\"]\'),r=f();if(null!==r&&!l(r))for(let n=0;n<t.length;n++){let o=t[n];o.addEventListener(\"click\",(function(t){t.preventDefault();let n=o.href.indexOf(\"?\")>-1?\"&\":\"?\";e.location.href=o.href+n+d(r)}))}}}}(window,document),window.addEventListener(\"message\",(e=>{let n=location.pathname,r=\".\"+location.host.split(\".\").slice(-2).join(\".\");switch(e.data){case\"global\":case\"fk\":t.set(\"show_region\",\"ftg\",{path:\"/\",domain:r,secure:!0,SameSite:\"None\"}),window.location.href=n+location.search;break;case\"uk\":t.set(\"show_region\",\"uk\",{path:\"/\",domain:r,secure:!0,SameSite:\"None\"}),window.location.href=\"/uk\"+n+location.search}}))})(),(()=>{function e(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}const t=function t(n,r){function o(t,o,i){if(\"undefined\"!=typeof document){\"number\"==typeof(i=e({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a=\"\";for(var c in i)i[c]&&(a+=\"; \"+c,!0!==i[c]&&(a+=\"=\"+i[c].split(\";\")[0]));return document.cookie=t+\"=\"+n.write(o,t)+a}}return Object.create({set:o,get:function(e){if(\"undefined\"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split(\"; \"):[],r={},o=0;o<t.length;o++){var i=t[o].split(\"=\"),a=i.slice(1).join(\"=\");try{var c=decodeURIComponent(i[0]);if(r[c]=n.read(a,c),e===c)break}catch(e){}}return e?r[e]:r}},remove:function(t,n){o(t,\"\",e({},n,{expires:-1}))},withAttributes:function(n){return t(this.converter,e({},this.attributes,n))},withConverter:function(n){return t(e({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(n)}})}({read:function(e){return\'\"\'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:\"/\"});function n(e){return n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},n(e)}document.addEventListener(\"DOMContentLoaded\",(function(){!function(){if(void 0!==(\"undefined\"==typeof GEOIP?\"undefined\":n(GEOIP))){var e=document.querySelectorAll(\'div[data-country=\"\'+GEOIP.country+\'\"], button[data-country=\"\'+GEOIP.country+\'\"]\');if(e.length>0)e.forEach((function(e){e.style.display=\"flex\"}));else{var t=document.getElementById(\"banner-default\");null!==t&&(t.style.display=\"flex\")}var r=document.getElementById(\"rw-text\"),o=document.getElementById(\"rw-text-\"+GEOIP.country);null!==r&&null!==o&&(r.innerText=o.innerText)}}();var e=document.getElementById(\"ext-reg-btn\"),r=t.get(\"agent[agent_id]\");null!==e&&void 0!==r&&-1===e.href.indexOf(\"partner_id\")&&(e.href=e.href+\"?partner_id=\"+r),void 0!==t.get(\"seminar_id\")&&t.remove(\"seminar_id\",{path:\"\",domain:\".forextime.com\"})}))})()})();//# sourceURL=reg-widget-host.js</script>';
iframe = iframe.replace(/\{([\w\_\.]+)\}/g, function(match, key) {
return params[key] || '';
});

document.write(iframe);

setTimeout(function() {
var iframe = document.getElementById('registration-step1-widget-iframe');
if (!iframe) {
  console.error('registration widget iframe has not been found');
  return;
}
if (window.GEOIP) {
  if (window.GEOIP.country) {
    iframe.setAttribute('data-src', iframe.getAttribute('data-src') + '&country=' + window.GEOIP.country);
  }
  if (window.GEOIP.redirect) {
    iframe.setAttribute('data-src', iframe.getAttribute('data-src') + '&redirect=' + window.GEOIP.redirect);
  }
}
if (window.location.href) {
  iframe.setAttribute('data-src', iframe.getAttribute('data-src') + '&_page=' + encodeURIComponent(window.location.href));
}
iframe.setAttribute('src', iframe.getAttribute('data-src'));
}, delay);

})(window);
